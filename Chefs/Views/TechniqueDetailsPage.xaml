<Page
    x:Class="Chefs.Views.TechniqueDetailsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:Chefs.Converters"
    xmlns:ctrl="using:Chefs.Views.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Chefs.Views"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:not_mobile="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:toolkit="using:Uno.UI.Toolkit"
    xmlns:uen="using:Uno.Extensions.Navigation.UI"
    xmlns:uer="using:Uno.Extensions.Reactive.UI"
    xmlns:ut="using:Uno.Themes"
    xmlns:utu="using:Uno.Toolkit.UI"
    HorizontalAlignment="Stretch"
    VerticalAlignment="Stretch"
    Background="{ThemeResource BackgroundBrush}"
    NavigationCacheMode="Enabled"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BoolToObjectConverter
            x:Key="BoolToHeartIconConverter"
            FalseValue="{StaticResource Icon_Heart}"
            TrueValue="{StaticResource Icon_Heart_Filled}" />

        <DataTemplate x:Key="EmptyTemplate">
            <utu:AutoLayout
                Padding="{utu:Responsive Normal='16,24',
                                         Wide='40'}"
                PrimaryAxisAlignment="Center"
                Spacing="24">
                <BitmapIcon
                    Width="72"
                    Height="72"
                    utu:AutoLayout.CounterAlignment="Center"
                    UriSource="{ThemeResource Empty_Technique}" />
                <TextBlock
                    Foreground="{ThemeResource OnSurfaceBrush}"
                    Style="{StaticResource TitleLarge}"
                    Text="No Reviews Yet"
                    TextAlignment="Center"
                    TextWrapping="Wrap" />
            </utu:AutoLayout>
        </DataTemplate>
    </Page.Resources>

    <utu:AutoLayout>
        <utu:NavigationBar Content="{Binding Technique.Name}">
            <utu:NavigationBar.PrimaryCommands>
                <AppBarButton Command="{Binding Share}">
                    <AppBarButton.Icon>
                        <PathIcon Data="{StaticResource Icon_Export}" Foreground="Lime" />
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton Command="{Binding Favorite}">
                    <AppBarButton.Icon>
                        <PathIcon Data="{Binding IsFavorited, Converter={StaticResource BoolToHeartIconConverter}, FallbackValue={StaticResource Icon_Heart}, TargetNullValue={StaticResource Icon_Heart}}" />
                    </AppBarButton.Icon>
                </AppBarButton>
            </utu:NavigationBar.PrimaryCommands>
        </utu:NavigationBar>

        <ScrollViewer
            utu:AutoLayout.PrimaryAlignment="Stretch"
            HorizontalScrollMode="Disabled"
            VerticalScrollBarVisibility="{utu:Responsive Normal=Visible,
                                                         Wide=Hidden}"
            VerticalScrollMode="{utu:Responsive Normal=Enabled,
                                                Wide=Disabled}">
            <utu:AutoLayout Padding="{utu:Responsive Normal='0,0,0,92', Wide=0}">
                <utu:AutoLayout
                    Padding="16"
                    CounterAxisAlignment="Center"
                    Orientation="Horizontal"
                    Spacing="8">
                    <PersonPicture
                        Width="32"
                        Height="32"
                        ProfilePicture="{Binding User.UrlProfileImage}" />
                    <TextBlock
                        Foreground="{ThemeResource OnBackgroundMediumBrush}"
                        Style="{StaticResource BodySmall}"
                        Text="{Binding User.FullName, Converter={StaticResource StringFormatter}, ConverterParameter='By {0}'}" />
                </utu:AutoLayout>
                <utu:AutoLayout
                    utu:AutoLayout.PrimaryAlignment="{utu:Responsive Normal=Auto,
                                                                     Wide=Stretch}"
                    Justify="{utu:Responsive Normal=SpaceBetween,
                                             Wide=Stack}"
                    Orientation="{utu:Responsive Normal=Vertical,
                                                 Wide=Horizontal}">
                    <utu:AutoLayout utu:AutoLayout.PrimaryAlignment="{utu:Responsive Normal=Auto, Wide=Stretch}" Spacing="{utu:Responsive Normal=8, Wide=0}">
                        <Image
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            utu:AutoLayout.PrimaryAlignment="Stretch"
                            Source="{Binding Technique.ImageUrl}"
                            Stretch="UniformToFill"
                            Visibility="{utu:Responsive Normal=Collapsed,
                                                        Wide=Visible}" />
                        <Border Height="300" Visibility="{utu:Responsive Normal=Visible, Wide=Collapsed}">
                            <Image
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Source="{Binding Technique.ImageUrl}"
                                Stretch="UniformToFill" />
                        </Border>
                        <utu:AutoLayout
                            Margin="{utu:Responsive Normal='16,263,16,0',
                                                    Wide='14,14,0,0'}"
                            HorizontalAlignment="{utu:Responsive Normal=Center,
                                                                 Wide=Left}"
                            VerticalAlignment="{utu:Responsive Normal=Center,
                                                               Wide=Top}"
                            utu:AutoLayout.IsIndependentLayout="True"
                            CornerRadius="4">
                            <utu:AutoLayout
                                Width="{utu:Responsive Normal=358,
                                                       Wide=98}"
                                Height="{utu:Responsive Normal=74,
                                                        Wide=317}"
                                Padding="{utu:Responsive Normal='0,4',
                                                         Wide='0,40'}"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch"
                                Background="{ThemeResource SurfaceBrush}"
                                Orientation="{utu:Responsive Normal=Horizontal,
                                                             Wide=Vertical}"
                                PrimaryAxisAlignment="Stretch">
                                <utu:AutoLayout
                                    utu:AutoLayout.PrimaryAlignment="Stretch"
                                    CounterAxisAlignment="Center"
                                    PrimaryAxisAlignment="Center"
                                    Spacing="4">
                                    <PathIcon Data="{StaticResource Icon_Timer}" Foreground="{ThemeResource OnSurfaceBrush}" />
                                    <TextBlock
                                        Foreground="{ThemeResource OnSurfaceMediumBrush}"
                                        Style="{StaticResource BodySmall}"
                                        Text="{Binding Technique.EstimateTime, Converter={StaticResource TimeSpanToStringConverter}}"
                                        TextAlignment="Center"
                                        TextWrapping="Wrap" />
                                </utu:AutoLayout>
                                <utu:AutoLayout
                                    utu:AutoLayout.PrimaryAlignment="Stretch"
                                    CounterAxisAlignment="Center"
                                    PrimaryAxisAlignment="Center"
                                    Spacing="4">
                                    <PathIcon Data="{StaticResource Icon_Star_Outline}" Foreground="{ThemeResource OnSurfaceBrush}" />
                                    <TextBlock
                                        Foreground="{ThemeResource OnSurfaceMediumBrush}"
                                        Style="{StaticResource BodySmall}"
                                        Text="{Binding Technique.Difficulty}"
                                        TextAlignment="Center"
                                        TextWrapping="Wrap" />
                                </utu:AutoLayout>
                                <utu:AutoLayout
                                    utu:AutoLayout.PrimaryAlignment="Stretch"
                                    CounterAxisAlignment="Center"
                                    PrimaryAxisAlignment="Center"
                                    Spacing="4">
                                    <PathIcon Data="{StaticResource Icon_Fire}" Foreground="{ThemeResource OnSurfaceBrush}" />
                                    <TextBlock
                                        Foreground="{ThemeResource OnSurfaceMediumBrush}"
                                        Style="{StaticResource BodySmall}"
                                        Text="{Binding Technique.Risk}"
                                        TextAlignment="Center"
                                        TextWrapping="Wrap" />
                                </utu:AutoLayout>
                            </utu:AutoLayout>
                        </utu:AutoLayout>
                    </utu:AutoLayout>
                    <utu:AutoLayout
                        x:Name="TabsLayout"
                        uen:Region.Attached="True"
                        utu:AutoLayout.PrimaryAlignment="Stretch"
                        Background="{ThemeResource BackgroundBrush}">
                        <utu:TabBar
                            Margin="{utu:Responsive Normal=0,
                                                    Wide='40,0'}"
                            uen:Region.Attached="True"
                            utu:AutoLayout.CounterAlignment="{utu:Responsive Normal=Start,
                                                                             Wide=Center}"
                            Background="{ThemeResource BackgroundBrush}"
                            Style="{StaticResource TopTabBarStyle}">
                            <utu:TabBarItem
                                uen:Region.Name="RisksTab"
                                Content="Risks"
                                Foreground="{ThemeResource OnSurfaceMediumBrush}" />
                            <utu:TabBarItem
                                uen:Region.Name="StepsTab"
                                Content="Steps"
                                Foreground="{ThemeResource OnSurfaceMediumBrush}" />
                            <utu:TabBarItem
                                uen:Region.Name="ComplianceTab"
                                Content="Compliance"
                                Foreground="{ThemeResource OnSurfaceMediumBrush}" />
                            <utu:TabBarItem
                                uen:Region.Name="ControlsTab"
                                Content="Controls"
                                IsSelected="True" />
                        </utu:TabBar>
                        <ScrollViewer utu:AutoLayout.PrimaryAlignment="{utu:Responsive Normal=Auto, Wide=Stretch}" HorizontalScrollMode="Disabled">
                            <Grid
                                x:Name="TabNavGrid"
                                uen:Region.Attached="True"
                                uen:Region.Navigator="Visibility">
                                <utu:AutoLayout
                                    Padding="{utu:Responsive Normal='16,24,16,16',
                                                             Wide=40}"
                                    uen:Region.Name="DetailsTab"
                                    Spacing="{utu:Responsive Normal=8,
                                                             Wide=16}">
                                    <TextBlock
                                        Foreground="{ThemeResource OnSurfaceBrush}"
                                        Style="{StaticResource BodyLarge}"
                                        Text="{Binding Details.Count, Converter={StaticResource StringFormatter}, ConverterParameter='{}{0} items'}"
                                        TextWrapping="Wrap" />
                                    <utu:AutoLayout Spacing="{utu:Responsive Normal=2, Wide=0}">
                                        <muxc:ItemsRepeater utu:AutoLayout.PrimaryAlignment="{utu:Responsive Normal=Stretch, Wide=Auto}" ItemsSource="{Binding Details}">
                                            <muxc:ItemsRepeater.Layout>
                                                <muxc:StackLayout Orientation="Vertical" Spacing="2" />
                                            </muxc:ItemsRepeater.Layout>
                                            <muxc:ItemsRepeater.ItemTemplate>
                                                <DataTemplate>
                                                    <utu:AutoLayout
                                                        Height="60"
                                                        Padding="8,0,16,0"
                                                        Background="{ThemeResource SurfaceBrush}"
                                                        CornerRadius="4"
                                                        CounterAxisAlignment="Center"
                                                        Justify="SpaceBetween"
                                                        Orientation="Horizontal"
                                                        Spacing="16">
                                                        <utu:AutoLayout CounterAxisAlignment="Center" Orientation="Horizontal">
                                                            <TextBlock
                                                                Padding="16"
                                                                Foreground="{ThemeResource OnSurfaceBrush}"
                                                                Style="{StaticResource TitleMedium}"
                                                                Text="{Binding Name}"
                                                                TextWrapping="Wrap" />
                                                        </utu:AutoLayout>

                                                        <Border
                                                            Padding="8"
                                                            Background="{ThemeResource BackgroundBrush}"
                                                            CornerRadius="4">
                                                            <TextBlock
                                                                Foreground="{ThemeResource OnSecondaryContainerBrush}"
                                                                Style="{StaticResource BodySmall}"
                                                                Text="{Binding Quantity}"
                                                                TextAlignment="End" />
                                                        </Border>
                                                    </utu:AutoLayout>
                                                </DataTemplate>
                                            </muxc:ItemsRepeater.ItemTemplate>
                                        </muxc:ItemsRepeater>
                                    </utu:AutoLayout>
                                </utu:AutoLayout>

                                <utu:AutoLayout
                                    Padding="{utu:Responsive Normal='16,24',
                                                             Wide=40}"
                                    uen:Region.Name="StepsTab"
                                    Spacing="{utu:Responsive Normal=8,
                                                             Wide=16}"
                                    Visibility="Collapsed">
                                    <TextBlock
                                        Foreground="{ThemeResource OnSurfaceBrush}"
                                        Style="{StaticResource BodyLarge}"
                                        Text="{Binding Steps.Count, Converter={StaticResource StringFormatter}, ConverterParameter='{}{0} steps'}"
                                        TextWrapping="Wrap" />
                                    <muxc:ItemsRepeater ItemsSource="{Binding Steps}">
                                        <muxc:ItemsRepeater.Layout>
                                            <muxc:StackLayout Orientation="Vertical" Spacing="2" />
                                        </muxc:ItemsRepeater.Layout>
                                        <muxc:ItemsRepeater.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{ThemeResource SurfaceBrush}" CornerRadius="4">
                                                    <utu:AutoLayout
                                                        Padding="16"
                                                        PrimaryAxisAlignment="Center"
                                                        Spacing="8">
                                                        <TextBlock
                                                            Foreground="{ThemeResource OnSurfaceBrush}"
                                                            Style="{StaticResource TitleSmall}"
                                                            Text="{Binding Name}"
                                                            TextWrapping="Wrap" />
                                                        <TextBlock
                                                            Foreground="{ThemeResource OnSurfaceMediumBrush}"
                                                            Text="{Binding Description}"
                                                            TextWrapping="Wrap" />
                                                    </utu:AutoLayout>
                                                </Border>
                                            </DataTemplate>
                                        </muxc:ItemsRepeater.ItemTemplate>
                                    </muxc:ItemsRepeater>
                                </utu:AutoLayout>

                                <utu:AutoLayout
                                    Padding="{utu:Responsive Normal='16,24',
                                                             Wide=40}"
                                    uen:Region.Name="ReviewsTab"
                                    Spacing="{utu:Responsive Normal=8,
                                                             Wide=16}"
                                    Visibility="Collapsed">
                                    <TextBlock
                                        Foreground="{ThemeResource OnSurfaceBrush}"
                                        Style="{StaticResource BodyLarge}"
                                        Text="{Binding Reviews.Count, Converter={StaticResource StringFormatter}, ConverterParameter='{}{0} comments'}"
                                        TextWrapping="Wrap"
                                        Visibility="{Binding Reviews.Count, Converter={StaticResource GreaterThanZeroToVisibleConverter}}" />
                                    <muxc:ItemsRepeater ItemsSource="{Binding Reviews}">
                                        <muxc:ItemsRepeater.Layout>
                                            <muxc:StackLayout Orientation="Vertical" Spacing="2" />
                                        </muxc:ItemsRepeater.Layout>
                                        <muxc:ItemsRepeater.ItemTemplate>
                                            <DataTemplate>
                                                <utu:AutoLayout
                                                    Padding="16"
                                                    Background="{ThemeResource SurfaceBrush}"
                                                    CornerRadius="4"
                                                    Orientation="Horizontal"
                                                    Spacing="16">
                                                    <PersonPicture
                                                        Width="60"
                                                        Height="60"
                                                        ProfilePicture="{Binding UrlAuthorImage}" />
                                                    <utu:AutoLayout
                                                        utu:AutoLayout.PrimaryAlignment="Stretch"
                                                        PrimaryAxisAlignment="Center"
                                                        Spacing="8">
                                                        <TextBlock
                                                            Foreground="{ThemeResource OnSurfaceBrush}"
                                                            Text="{Binding Description}"
                                                            TextWrapping="Wrap" />
                                                        <TextBlock
                                                            Foreground="{ThemeResource OnSurfaceMediumBrush}"
                                                            Text="{Binding PublisherName}"
                                                            TextWrapping="Wrap" />
                                                        <utu:AutoLayout
                                                            Padding="{utu:Responsive Normal='0,16,0,16',
                                                                                     Wide='0,16,0,0'}"
                                                            CounterAxisAlignment="Center"
                                                            Orientation="Horizontal"
                                                            Spacing="{utu:Responsive Normal=8,
                                                                                     Wide=24}">
                                                            <ToggleButton
                                                                HorizontalContentAlignment="Center"
                                                                VerticalContentAlignment="Center"
                                                                Command="{utu:AncestorBinding AncestorType=uer:FeedView,
                                                                                              Path=DataContext.Like}"
                                                                CommandParameter="{Binding}"
                                                                IsChecked="{Binding UserLike, Converter={StaticResource UserLikeCheckedConverter}, Mode=TwoWay}">
                                                                <ToggleButton.Content>
                                                                    <utu:AutoLayout
                                                                        CounterAxisAlignment="Center"
                                                                        Orientation="Horizontal"
                                                                        Spacing="{utu:Responsive Normal=5,
                                                                                                 Wide=8}">
                                                                        <PathIcon Data="{StaticResource Icon_Thumb_Up_Off}" Foreground="{ThemeResource PrimaryBrush}" />
                                                                        <TextBlock
                                                                            Foreground="{ThemeResource PrimaryBrush}"
                                                                            Style="{StaticResource LabelLarge}"
                                                                            Text="{Binding Likes.Count}" />
                                                                    </utu:AutoLayout>
                                                                </ToggleButton.Content>
                                                                <ut:ControlExtensions.AlternateContent>
                                                                    <utu:AutoLayout
                                                                        CounterAxisAlignment="Center"
                                                                        Orientation="Horizontal"
                                                                        Spacing="{utu:Responsive Normal=5,
                                                                                                 Wide=8}">
                                                                        <PathIcon Data="{StaticResource Icon_Thumb_Up}" Foreground="{ThemeResource PrimaryBrush}" />
                                                                        <TextBlock
                                                                            Foreground="{ThemeResource PrimaryBrush}"
                                                                            Style="{StaticResource LabelLarge}"
                                                                            Text="{Binding Likes.Count}" />
                                                                    </utu:AutoLayout>
                                                                </ut:ControlExtensions.AlternateContent>
                                                            </ToggleButton>
                                                            <ToggleButton
                                                                HorizontalContentAlignment="Center"
                                                                VerticalContentAlignment="Center"
                                                                Command="{utu:AncestorBinding AncestorType=uer:FeedView,
                                                                                              Path=DataContext.Dislike}"
                                                                CommandParameter="{Binding}"
                                                                IsChecked="{Binding UserLike, Converter={StaticResource UserDislikeCheckedConverter}, Mode=TwoWay}">
                                                                <ToggleButton.Content>
                                                                    <utu:AutoLayout
                                                                        CounterAxisAlignment="Center"
                                                                        Orientation="Horizontal"
                                                                        Spacing="{utu:Responsive Normal=5,
                                                                                                 Wide=8}">
                                                                        <PathIcon Data="{StaticResource Icon_Thumb_Down_Off}" Foreground="{ThemeResource PrimaryBrush}" />
                                                                        <TextBlock
                                                                            Foreground="{ThemeResource PrimaryBrush}"
                                                                            Style="{StaticResource LabelLarge}"
                                                                            Text="{Binding Dislikes.Count}" />
                                                                    </utu:AutoLayout>
                                                                </ToggleButton.Content>
                                                                <ut:ControlExtensions.AlternateContent>
                                                                    <utu:AutoLayout
                                                                        CounterAxisAlignment="Center"
                                                                        Orientation="Horizontal"
                                                                        Spacing="8">
                                                                        <PathIcon Data="{StaticResource Icon_Thumb_Down}" Foreground="{ThemeResource PrimaryBrush}" />
                                                                        <TextBlock
                                                                            Foreground="{ThemeResource PrimaryBrush}"
                                                                            Style="{StaticResource LabelLarge}"
                                                                            Text="{Binding Dislikes.Count}" />
                                                                    </utu:AutoLayout>
                                                                </ut:ControlExtensions.AlternateContent>
                                                            </ToggleButton>
                                                        </utu:AutoLayout>
                                                    </utu:AutoLayout>
                                                </utu:AutoLayout>
                                            </DataTemplate>
                                        </muxc:ItemsRepeater.ItemTemplate>
                                    </muxc:ItemsRepeater>
                                </utu:AutoLayout>

                                <Grid uen:Region.Name="RisksTab" Visibility="Collapsed">
                                    <Grid
                                        Margin="{utu:Responsive Normal=16,
                                                                Wide=40}"
                                        Padding="{utu:Responsive Normal=16,
                                                                 Wide=24}"
                                        Background="{ThemeResource SurfaceBrush}"
                                        CornerRadius="24"
                                        RowSpacing="{utu:Responsive Normal=5,
                                                                    Wide=24}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <TextBlock
                                            Foreground="{ThemeResource OnBackgroundBrush}"
                                            Style="{StaticResource TitleLarge}"
                                            Text="Intake per serving"
                                            TextAlignment="Center" />
                                        <ctrl:ChartControl
                                            Grid.Row="1"
                                            DataContext="{Binding Technique}"
                                            DataLabelBrush="{ThemeResource NutritionDataLabelBrush}"
                                            DataRiskBrush="{ThemeResource DataRiskValBrush}"
                                            DeviceRiskBrush="{ThemeResource DeviceRiskValBrush}"
                                            TrackBackgroundBrush="{ThemeResource NutritionTrackBackgroundBrush}"
                                            UserRiskBrush="{ThemeResource UserRiskValBrush}" />
                                    </Grid>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </utu:AutoLayout>
                </utu:AutoLayout>
            </utu:AutoLayout>
        </ScrollViewer>

        <Button
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            utu:AutoLayout.IsIndependentLayout="True"
            Command="{Binding LiveCooking}"
            Content="Start Cooking!"
            Style="{StaticResource ChefsFabButtonStyle}">
            <ut:ControlExtensions.Icon>
                <FontIcon Glyph="{StaticResource Icon_Carrot}" Style="{StaticResource FontAwesomeSolidFontIconStyle}" />
            </ut:ControlExtensions.Icon>
        </Button>
    </utu:AutoLayout>
</Page>
